# Makefile for macOS distribution automation of Digital Circuit Simulator

.PHONY: all clean icon input app help install test

# Default target
all: app

# Help
help:
	@echo "ğŸš€ Digital Circuit Simulator - macOS Automation"
	@echo "==============================================="
	@echo ""
	@echo "Available targets:"
	@echo "  all        - Create complete app (default)"
	@echo "  app        - Create Digital.app"
	@echo "  icon       - Generate only .icns icon"
	@echo "  input      - Prepare only input directory"
	@echo "  clean      - Clean all generated files"
	@echo "  install    - Install app in /Applications"
	@echo "  test       - Test created app"
	@echo "  help       - Show this help"
	@echo ""
	@echo "Examples:"
	@echo "  make app           # Create complete app"
	@echo "  make clean app     # Clean and recreate app"
	@echo "  make install       # Install app in /Applications"

# Cleanup
clean:
	@echo "ğŸ§¹ Cleaning generated files..."
	@rm -rf Digital.app
	@rm -rf jpackage-input
	@rm -f icon.icns
	@echo "âœ… Cleanup completed"

# Icon generation
icon:
	@echo "ğŸ¨ Generating macOS icon..."
	@./generate-icon.sh

# Input preparation
input:
	@echo "ğŸ“ Preparing input directory..."
	@./prepare-input.sh

# Complete app creation
app:
	@echo "ğŸš€ Creating Digital.app..."
	@./create-digital-app.sh

# Installation in /Applications
install: app
	@echo "ğŸ“± Installing in /Applications..."
	@if [ -d "/Applications/Digital.app" ]; then \
		echo "   ğŸ—‘ï¸  Removing existing version..."; \
		rm -rf "/Applications/Digital.app"; \
	fi
	@cp -r Digital.app /Applications/
	@echo "âœ… Digital.app installed in /Applications"

# App testing
test: app
	@echo "ğŸ§ª Testing created app..."
	@if [ -d "Digital.app" ]; then \
		echo "   âœ… Digital.app found"; \
		echo "   ğŸ“Š Size: $$(du -sh Digital.app | cut -f1)"; \
		echo "   ğŸ” Verifying structure..."; \
		if [ -f "Digital.app/Contents/Info.plist" ]; then \
			echo "   âœ… Info.plist present"; \
		else \
			echo "   âŒ Info.plist missing"; \
			exit 1; \
		fi; \
		if [ -f "Digital.app/Contents/MacOS/Digital" ]; then \
			echo "   âœ… Executable present"; \
		else \
			echo "   âŒ Executable missing"; \
			exit 1; \
		fi; \
		if [ -f "Digital.app/Contents/app/Digital.jar" ]; then \
			echo "   âœ… Main JAR present"; \
		else \
			echo "   âŒ Main JAR missing"; \
			exit 1; \
		fi; \
		echo "   ğŸš€ Starting app test..."; \
		open Digital.app; \
		echo "   âœ… App started successfully"; \
	else \
		echo "   âŒ Digital.app not found"; \
		exit 1; \
	fi

# Developer targets
dev-clean: clean
	@echo "ğŸ§¹ Complete cleanup for developers..."
	@cd ../.. && mvn clean
	@echo "âœ… Maven cleanup completed"

dev-build:
	@echo "ğŸ”¨ Complete build for developers..."
	@cd ../.. && mvn package
	@echo "âœ… Maven build completed"

dev-all: dev-clean dev-build app
	@echo "âœ… Complete build and app created"